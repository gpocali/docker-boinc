# docker-boinc
This is an expansion on LinuxServer/boinc image to include nut-client for suspending while on UPS battery and resuming tasks when power is back online.

## New Environmental Variables in this Docker vs linuxserver/boinc
* NUT_UPS - Name of ups on NUT server
* NUT_SERVER - IP Address or hostname of NUT server
* NUT_USER - Username of NUT server
* NUT_SECRET - Password for user on NUT server

## Setup Exclusive Applications in BOINC Client
* Open BOINC administration webUI
* Click Options>Exclusive Applications
* Under Suspend Processor and Network Usage, click the Add button
* Select "nutWait" from list and click open
* Under Suspend GPU Usage, click the Add button
* Select "nutWait" from list again and click open
* You should now see nutWait listed in both sections, click Save
* Verify that the Activity menu has 'Run based on preferences' and 'Use GPU based on preferences' selected (required)

# Modified linuxserver/boinc readme
## Usage

Here are some example snippets to help you get started creating a container.

### docker

```
docker create \
  --name=boinc \
  -e PUID=1000 \
  -e PGID=1000 \
  -e TZ=Europe/London \
  -e GUAC_USER=abc `#optional` \
  -e GUAC_PASS=900150983cd24fb0d6963f7d28e17f72 `#optional` \
  -e NUT_UPS=upsName \
  -e NUT_SERVER=192.168.1.10 \
  -e NUT_USER=user \
  -e NUT_SECRET=secret \
  -p 8080:8080 \
  -v /path/to/data:/config \
  --device /dev/dri:/dev/dri `#optional` \
  --restart unless-stopped \
  linuxserver/boinc
```


### docker-compose

Compatible with docker-compose v2 schemas.

```
---
version: "2"
services:
  boinc:
    image: linuxserver/boinc
    container_name: boinc
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
      - GUAC_USER=abc #optional
      - GUAC_PASS=900150983cd24fb0d6963f7d28e17f72 #optional
	  - NUT_UPS=upsName
	  - NUT_SERVER=192.168.1.10
	  - NUT_USER=user
	  - NUT_SECRET=secret
    volumes:
      - /path/to/data:/config
    ports:
      - 8080:8080
    devices:
      - /dev/dri:/dev/dri #optional
    restart: unless-stopped
```

## Parameters

Container images are configured using parameters passed at runtime (such as those above). These parameters are separated by a colon and indicate `<external>:<internal>` respectively. For example, `-p 8080:80` would expose port `80` from inside the container to be accessible from the host's IP on port `8080` outside the container.

| Parameter | Function |
| :----: | --- |
| `-p 8080` | Boinc desktop gui. |
| `-e PUID=1000` | for UserID - see below for explanation |
| `-e PGID=1000` | for GroupID - see below for explanation |
| `-e TZ=Europe/London` | Specify a timezone to use EG Europe/London. |
| `-e GUAC_USER=abc` | Username for the BOINC desktop gui. |
| `-e GUAC_PASS=900150983cd24fb0d6963f7d28e17f72` | Password's md5 hash for the BOINC desktop gui. |
| `-e NUT_UPS=upsName` | Name of ups on NUT server. |
| `-e NUT_SERVER=192.168.1.10` | IP Address or hostname of NUT server. |
| `-e NUT_USER=user` | Username on NUT server. |
| `-e NUT_SECRET=secret` | Password for user on NUT server. |
| `-v /config` | Where BOINC should store its database and config. |
| `--device /dev/dri` | Only needed if you want to use your Intel GPU (vaapi). |

## Environment variables from files (Docker secrets)

You can set any environment variable from a file by using a special prepend `FILE__`. 

As an example:

```
-e FILE__PASSWORD=/run/secrets/mysecretpassword
```

Will set the environment variable `PASSWORD` based on the contents of the `/run/secrets/mysecretpassword` file.

## User / Group Identifiers

When using volumes (`-v` flags) permissions issues can arise between the host OS and the container, we avoid this issue by allowing you to specify the user `PUID` and group `PGID`.

Ensure any volume directories on the host are owned by the same user you specify and any permissions issues will vanish like magic.

In this instance `PUID=1000` and `PGID=1000`, to find yours use `id user` as below:

```
  $ id username
    uid=1000(dockeruser) gid=1000(dockergroup) groups=1000(dockergroup)
```


&nbsp;
## Application Setup

This image sets up the BOINC client and manager and makes its interface available via Guacamole server in the browser. The interface is available at `http://your-ip:8080`.

By default, there is no username or password set. Custom usernames and passwords can be set via optional docker environment variables. Keep in mind that the `GUACPASS` variable accepts the `md5 hash` of the desired password (the sample above is the hash for `abc`). The md5 hash can be generated by either of the following commands:

```
echo -n password | openssl md5
```

```
printf '%s' password | md5sum
```

You can access advanced features of the Guacamole remote desktop using `ctrl`+`alt`+`shift` enabling you to use remote copy/paste and different languages.

It is recommended to switch to `Advanced View` in the top menu, because the `Computing Preferences` don't seem to be displayed in `Simple View`.

Sometimes, the pop-up windows may open in a tiny box in the upper left corner of the screen. When that happens, you can find the corner and resize them.

## GPU Hardware Acceleration

### Intel

Hardware acceleration users for Intel Quicksync will need to mount their /dev/dri video device inside of the container by passing the following command when running or creating the container:
```--device=/dev/dri:/dev/dri```
We will automatically ensure the abc user inside of the container has the proper permissions to access this device.

### Nvidia

Hardware acceleration users for Nvidia will need to install the container runtime provided by Nvidia on their host, instructions can be found here:
https://github.com/NVIDIA/nvidia-docker
We automatically add the necessary environment variable that will utilise all the features available on a GPU on the host. Once nvidia-docker is installed on your host you will need to re/create the docker container with the nvidia container runtime `--runtime=nvidia` and add an environment variable `-e NVIDIA_VISIBLE_DEVICES=all` (can also be set to a specific gpu's UUID, this can be discovered by running `nvidia-smi --query-gpu=gpu_name,gpu_uuid --format=csv` ). NVIDIA automatically mounts the GPU and drivers from your host into the BOINC docker container.



## Support Info

* Shell access whilst the container is running: `docker exec -it boinc /bin/bash`
* To monitor the logs of the container in realtime: `docker logs -f boinc`
* container version number
  * `docker inspect -f '{{ index .Config.Labels "build_version" }}' boinc`
* image version number
  * `docker inspect -f '{{ index .Config.Labels "build_version" }}' linuxserver/boinc`

## Updating Info

Most of our images are static, versioned, and require an image update and container recreation to update the app inside. With some exceptions (ie. nextcloud, plex), we do not recommend or support updating apps inside the container. Please consult the [Application Setup](#application-setup) section above to see if it is recommended for the image.

Below are the instructions for updating containers:

### Via Docker Run/Create
* Update the image: `docker pull linuxserver/boinc`
* Stop the running container: `docker stop boinc`
* Delete the container: `docker rm boinc`
* Recreate a new container with the same docker create parameters as instructed above (if mapped correctly to a host folder, your `/config` folder and settings will be preserved)
* Start the new container: `docker start boinc`
* You can also remove the old dangling images: `docker image prune`

### Via Docker Compose
* Update all images: `docker-compose pull`
  * or update a single image: `docker-compose pull boinc`
* Let compose update all containers as necessary: `docker-compose up -d`
  * or update a single container: `docker-compose up -d boinc`
* You can also remove the old dangling images: `docker image prune`
